![Nuclio logo](https://nuclio.school/wp-content/uploads/2018/12/nucleoDS-newBlack.png)

# TFM - An√°lisis Exploratorio de Datos (EDA)

### *Descripci√≥n del dataset y su contexto:*
El presente dataset contiene informaci√≥n detallada sobre propiedades en venta, incluyendo su precio, ubicaci√≥n, dimensiones y diversas caracter√≠sticas adicionales. Cada registro representa un anuncio de un inmueble y cuenta con datos sobre su barrio, distrito, consumo energ√©tico y otros atributos socioecon√≥micos.

El objetivo de este Notebook es analizar el conjunto de datos para extraer insights que permitan comprender mejor el mercado inmobiliario en Madrid y detectar patrones que puedan ser √∫tiles para la toma de decisiones.

### *Objetivos del EDA:*
1. Comprender la estructura del dataset: Identificar el n√∫mero de registros y columnas, los tipos de datos y la presencia de valores nulos o inconsistencias.
2. Analizar la distribuci√≥n de las variables: Explorar la variabilidad en precios, metros cuadrados, ubicaciones y otras caracter√≠sticas relevantes.
3. Detectar relaciones y correlaciones: Investigar posibles asociaciones entre las variables y su impacto en el precio de los inmuebles.
4. Identificar valores at√≠picos: Detectar posibles errores o anomal√≠as en los datos que puedan afectar el an√°lisis.
5. Generar insights clave: Extraer informaci√≥n relevante para futuros estudios o modelos de predicci√≥n del valor de los inmuebles.

Este an√°lisis servir√° como base para entender mejor la din√°mica entre las variables y obtener un fichero CSV para ejecutar un modelo predictivo del precio de las vviendas en Madrid.
# *1. Librer√≠as y configuraci√≥n*
# *2. Funciones*
# --- Configuraci√≥n inicial ---
# Funci√≥n para asignar el grupo en funci√≥n del precio y los bins
def asignar_grupo_por_precio(precio, bins):
    return np.digitize([precio], bins, right=False)[0]

# Funci√≥n principal para gestionar los c√≥digos de barrio
def gestionar_codigos_barrio(df, nuevo_cod_barrio=None, nuevo_precio=None):
    # Cargar o inicializar mapeo y bins
    try:
        with open('cod_barrio_mapping.json', 'r', encoding='utf-8') as archivo:
            cod_barrio_mapping = json.load(archivo)
    except FileNotFoundError:
        cod_barrio_mapping = {}

    try:
        with open('bins.json', 'r', encoding='utf-8') as archivo:
            bins = np.array(json.load(archivo))
    except FileNotFoundError:
        bins = None

    # Si no hay bins, recalcular con los datos existentes
    if bins is None or not cod_barrio_mapping:
        codbarrio_precios = df.groupby('cod_barrio')['precio'].mean().reset_index()
        codbarrio_precios['cod_barrio_group'], bins = pd.qcut(
            codbarrio_precios['precio'], q=5, labels=[1, 2, 3, 4, 5], retbins=True
        )
        cod_barrio_mapping.update(dict(zip(codbarrio_precios['cod_barrio'], codbarrio_precios['cod_barrio_group'])))

        # Guardar el mapeo y los bins en archivos JSON
        with open('cod_barrio_mapping.json', 'w', encoding='utf-8') as archivo:
            json.dump(cod_barrio_mapping, archivo, ensure_ascii=False, indent=4)
        with open('bins.json', 'w', encoding='utf-8') as archivo:
            json.dump(bins.tolist(), archivo, ensure_ascii=False, indent=4)

    # Manejar un nuevo c√≥digo de barrio
    if nuevo_cod_barrio is not None and nuevo_precio is not None:
        if nuevo_cod_barrio not in cod_barrio_mapping:
            nuevo_grupo = asignar_grupo_por_precio(nuevo_precio, bins)
            cod_barrio_mapping[nuevo_cod_barrio] = nuevo_grupo
            print(f"Nuevo c√≥digo de barrio {nuevo_cod_barrio} asignado al grupo {nuevo_grupo}.")

            # Actualizar y guardar el mapeo
            with open('cod_barrio_mapping.json', 'w', encoding='utf-8') as archivo:
                json.dump(cod_barrio_mapping, archivo, ensure_ascii=False, indent=4)

    # Actualizar los grupos en el DataFrame
    df['cod_barrio_group'] = df['cod_barrio'].map(cod_barrio_mapping)

    # Identificar c√≥digos desconocidos para controlar posibles fallos
    desconocidos = df[df['cod_barrio_group'].isna()]
    if not desconocidos.empty:
        print("Advertencia: Algunos c√≥digos de barrio no tienen grupo asignado:")
        print(desconocidos['cod_barrio'].unique())

    return df




# *3. Carga de datos*
Carga del fichero con las caracteristicas de los pisos
Carga del fichero con las caracteristicas adicionales que se van a a√±adir al modelo
# *4. Exploraci√≥n de datos*
En esta primera tabla, ya vemos variables con desviaci√≥n tipica 0, (tiene_armario,inmuebles_ingresos,alquiler_con_opcion_compra) por lo que podremos eliminar esas columnas que no aportan informaci√≥n al estudio.
## *4.1 Tipo de datos*
### *4.1.1 Transformaci√≥n del tipo de variables*
Vamos a cambiar el tipo de dato de las siguientes columnas
## *4.2 Identificacion de valores nulos*
Los valores nulos pueden afectar los an√°lisis estad√≠sticos y las visualizaciones.

Antes de tomar decisiones sobre c√≥mo gestionar los valores nulos, tenemos que evaluar cu√°ntos datos faltan y en qu√© proporci√≥n dentro del conjunto de datos.

Tenemos que entender por qu√© faltan los datos.

En este conjunto de datos, tomados mediante la t√©cnica de web scraping, tendremos valores nulos fundamentalmente por tres motivos y siempre de manera aleatoria:
  - El proceso de scraping no ha tomado todos los valores de cada vivienda publicada en la web.
  - La web no informaba del dato porque no lo consider√≥ necesario (p. ej., carpinter√≠as).
  - La web no informaba del dato porque la vivienda ten√≠a ausencia de ello (p. ej., piscina).

Los datos faltantes pueden ser:
  - Aleatorios, sin depender de otras variables.
  - Relacionados con otras variables observadas.
  - Los datos faltan debido a factores relacionados con los valores en s√≠ mismos, lo que puede introducir sesgos.


Al tratar los valores nulos tenemos que evitar introducir sesgos que puedan alterar la interpretaci√≥n de los datos. Si, por ejemplo, los datos faltantes est√°n asociados con patrones espec√≠ficos, tratarlos incorrectamente podr√≠a distorsionar los resultados.

Para tratarlos, revisaremos:
- La cantidad de valores nulos por columna.
- El porcentaje de valores nulos en relaci√≥n con el total de datos.
- Identificaci√≥n y eliminaci√≥n de columnas con m√°s del 90% de valores nulos
- Visualizaci√≥n de los valores nulos para identificar patrones.

Representaci√≥n grafica de los valores nulos
*El an√°lisis de valores nulos nos permite detectar qu√© columnas requieren tratamiento antes de continuar con el an√°lisis exploratorio. Realizaremos la imputaci√≥n de esos nulos en variables importantes como dormitorios y ba√±o y evaluar la eliminaci√≥n de aquellas con un alto porcentaje de valores faltantes si no aportan informaci√≥n significativa al estudio.*

Observaciones:
- Se identifican m√∫ltiples columnas con una gran cantidad de valores nulos p.e. "alquiler-opcion_a_compra" √≥ "acceso_discapacidad" (representadas en azul oscuro).
- Algunas columnas tienen valores ausentes de manera dispersa, como puede ser "letra_ce", mientras que otras presentan grandes bloques de datos faltantes ("videoportero").
- Hay varias variables con una cantidad significativa de valores faltantes, especialmente aquellas relacionadas con caracter√≠sticas del inmueble, carpinter√≠a, eficiencia energ√©tica,etc
- La variable target `precio` asi como las variables de ubicaci√≥n `distrito` y `barrio` no tienen valores nulos.
Vamos a eliminare columnas con mas del 95% de valores nulos ya que aportan muy poca informaci√≥n y manterlas aumenta la complejidad sin ofrecer beneficios.
Las siguientes columnas presentan un alto porcentaje de valores nulos:

- **`inmueble_ingresos`**: 99.91% de los valores son nulos.
- **`alquiler_opcion_a_compra`**: 99.97% de los valores son nulos.
- **`nuda_propiedad`**: 99.87% de los valores son nulos.

Estas columnas se refieren a viviendas con caracter√≠sticas espec√≠ficas de transacci√≥n:
- **`alquiler_opcion_a_compra`**:viviendas en alquiler con opci√≥n a compra seg√∫n contrato.
- **`inmueble_ingresos`**: Representa viviendas alquiladas que generan ingresos.
- **`nuda_propiedad`**: Corresponde a viviendas donde no se tiene la posesi√≥n plena (por ejemplo, derechos limitados sobre la propiedad).


Debido al bajo tama√±o de muestra para estas categor√≠as, he decidido eliminar este tipo de viviendas del an√°lisis. El modelo se construir√° exclusivamente para viviendas de venta libre de cargas, lo que permitir√° obtener resultados m√°s representativos y √∫tiles.
Elimino las columnas con m√°s de 95% de valores nulos
## *4.3 Identificaci√≥n variables con varianza nula*
## *4.4 Identificaci√≥n de datos duplicados*
Identificamos si existen registros duplicados ya que pueden distorsionar el an√°lisis y deben ser detectados para eliminarlos.
* Analizaremos si es posible que tengamos el mismo piso en venta en distintas webs, para ello identificamos como primary key la combinaci√≥n de esas columnas 

['cod_barrio', 'cod_distrito','codigo_postal','m2_constr', 'dormitorios', 'banos', 'precio','estado','planta']
#ahora los duplicados que tengo son de mas de dos registros
#comparemos las webs por que duplicados de la misma web no son duplicados
En Obra nueva es facil tener duplicados por que puede haber varias viviendas con las mismas caracterisicas de localizaci√≥n ,m2, precio, etc. En segunda mano suponemos que se ha publicado la misma vivienda en diferentes webs.
# *5. Variable `target`*
La variable target del analisis es la columna `precio`.

La columna precio es de tipo int64, la transformamos a float64, ya que el precio de venta de las viviendas es la variable objetivo en nuestro an√°lisis y el tipo de dato float64 es adecuado para manejar valores de precio con precisi√≥n decimal.
Hay 9869 datos disponibles, es una muestra razonablemente grande y representativa.
El precio promedio es de 887513,3 , esta m√©trica podr√≠a estar influenciada por valores at√≠picos debido a los precios extremadamente altos.
La desviaci√≥n est√°ndar es bastante elevada 1149722,65, lo que indica una gran variabilidad en los precios.

El precio m√°s bajo registrado es 54.000, lo que sugiere que incluye viviendas de bajo costo.
El precio m√°s alto es 19.950.000 lo que sugiere la presencia de viviendas de lujo o at√≠picas.

Hay una fuerte asimetr√≠a positiva en la distribuci√≥n, ya que el valor medio 890.192,68 es mucho mayor que la mediana 475.000. Esto sugiere que unos pocos precios extremadamente altos est√°n influyendo en la media.


## *5.1 Valores at√≠picos*
Observaciones:

- Se han revisado algunas de las urls de las webs de donde se hizo el *Web Scraping* de los anuncios con precios atipicos y hemos verificado que son correctos.
## *5.2 Distribuci√≥n*
Observaciones:
- La distribuci√≥n est√° fuertemente sesgada a la derecha ya que la mayor√≠a de los inmuebles tienen precios concentrados en el rango bajo (por debajo de 1 mill√≥n de euros, sobre todo en un rango de 200k‚Ç¨ - 400k‚Ç¨). A medida que el precio aumenta, la frecuencia de inmuebles disminuye dr√°sticamente.
- Existen algunos inmuebles con precios muy elevados (por encima de 5M‚Ç¨, hasta casi los 20M‚Ç¨),picos pronunciados con colas muy largas, lo que sugiere que hay propiedades de lujo o con precios excepcionalmente altos (outliers) dentro del dataset.
- La mayor parte del mercado parece estar en rangos de precios menores al millon de euros pero hay un n√∫mero reducido de inmuebles en rangos m√°s altos, lo que indica que las viviendas de lujo son menos frecuentes.

La variable `precio` no sigue una distribuci√≥n normal. Esto podr√≠a ser relevante al aplicar t√©cnicas estad√≠sticas que asumen normalidad. Ser√° √∫til realizar una transformaci√≥n de datos (como logaritmos) o usar m√©tricas robustas para manejar los valores extremos. 

# *6. Union datos pisos y datos adicionales*
Adem√°s del web scraping realizado en p√°ginas webs de venta de viviendas, se ha recopilado informaci√≥n adicional, proveniente de diferentes webs, entre ellas los datos abiertos del Ayuntamiento de Madrid. Estos datos han sido organizados en un archivo clasificado por barrios o distritos. Posteriormente, este conjunto de datos se integra con nuestra base de datos de viviendas, con el objetivo de enriquecer el modelo y mejorar su precisi√≥n.
Algunas columnas de los datos adicionales est√°n informadas a nivel de distrito y otras a nivel de barrio
En el conjunto de datos dfadicionales podemos asumir que los valores nulos son 0 por que si no estan informados es que no tienen valor
## *6.1 Merge datos pisos y datos adicionales*
En primer lugar seleccionamos las columnas que tienen informados los datos a nivel de barrio
Comprobamos el numero de filas y columnas de nuestros dataframes
# *7. An√°lisis estad√≠stico inicial*
## *7.1 An√°lisis univariado*
El an√°lisis univariado nos va a permitir estudiar la distribuci√≥n de cada variable por separado, identificando patrones, valores at√≠picos y posibles problemas en los datos.
Ejecutamos de nuevo la funcion columnas_por_tipo para cargar las variables con las nuevas columnas incluidas en el  dataframe
### *7.1.1 Variables num√©ricas*


En nuestro dataset existen dos tipos de variables cuantitativas:

- **Discretas**: Son aquellas que √∫nicamente pueden tomar un conjunto limitado de valores aislados y separados, generalmente representados como n√∫meros enteros.
- **Continuas**: Son aquellas que pueden asumir cualquier valor dentro de un intervalo o rango espec√≠fico.

Vamos a analizar las variables n√∫mericas mediante histogramas para observar su distribuci√≥n y boxplots √≥ graficos de violin para detectar posibles valores at√≠picos.
Observaciones:
- A primera vista vemos que tenemos dos tipos de variables n√∫mericas, discretas y continuas. Adem√°s muchas de las variables discretas son binarias.
Variables continuas: precio,m2_constr,etc
Variables binarias: variables de orientacion, carpinteria,exterior,...
Variables discretas no binarias:dormitorios , banos,..

- En los histogramas (azules) que muestran c√≥mo se distribuyen los valores de cada variable , se  pueden identificar distribuciones sesgadas en algunas variables continuas, con datos concentrados en ciertos rangos. Por ejemplo tanto  `precio` como  `m2_constr`y viv_nuevas_transaciones tienen distribuciones sesgadas a la derecho con acumulacion de valores bajos .
- En el caso de las variables binarias tienen solo dos valores posibles (0 o 1), indicando la presencia o ausencia de una caracter√≠stica en el inmueble como es el caso de `balcon`, `terraza`, `trastero`, `ascensor`, `nuda_propiedad`, `acceso_discapacidad`.
 Los gr√°ficos de viol√≠n (verdes) y los histogramas nos muestran cu√°les de estas variables tienen una distribuci√≥n altamente desbalanceada (p.e interior √≥ tiene_armario)
- Sobre las variables con un solo valor pueden eliminarse del an√°lisis o reemplazar los valores nulos por 0 si se asume que la ausencia del dato significa que la caracter√≠stica no est√° presente, como por ejemplo  `cancha_tenis`, `tiene_piscina`.
- Algunas variables como `num_plantas`, `num_personas`, `total_transacciones`, `lineas_metro`, `hogares`, `servicios_profesionales`, tienen una distribuci√≥n amplia, lo que sugiere una gran variabilidad en los datos.
### *7.1.2 Variables categ√≥ricas*
Para las variables categ√≥ricas, vamos a utilizar gr√°ficos de barras para realizar el analisis ya que ayudan a visualizar la frecuencia de cada categor√≠a.
Observaciones: En varias variables, hay una categor√≠a dominante.
- `tipo_fachada`: Tiene una variedad de materiales, pero "Ladrillo" es el m√°s com√∫n, lo que puede reflejar tendencias constructivas predominantes en la regi√≥n.
- `tipo_calefaccion`: La mayor√≠a de los inmuebles no tienen calefacci√≥n o no se ha especificado.
- `tipologia`: Nos indica que existen mucho m√°s ofertas de "pisos" que de otra tipolog√≠a de vivienda.
- `tipo_inmueble`: La categor√≠a "lujo" tiene una mayor representaci√≥n en comparaci√≥n con otras categor√≠as como "econ√≥mico" o "medio". Hay que verificar si es por presencia de nulos en las observaciones de la mayor√≠a de los inmuebles.
- `estado`: Presenta una mayor cantidad de registros en "En buen estado" y "Buena/muy buena calidad", indicando que la mayor√≠a de los inmuebles ofertados est√°n en condiciones √≥ptimas.
- `letra_ce`: Muestra que muchos inmuebles tienen clasificaciones energ√©ticas bajas (E, G, D), lo que puede ser un factor importante para compradores interesados en eficiencia.
- Existen categorias con muchos valores diferentes que se pueden agrupar para realizar el analisis, p.e. antiguedad √≥ estado.
## *7.2 An√°lisis bivariado*
El an√°lisis bivariado nos permite estudiar la relaci√≥n entre dos variables, ya sean num√©ricas o categ√≥ricas.
### *7.2.1 Variables num√©ricas*

#### *7.2.1.1 Pairplots*
Utilizaremos *Pairplots* para ver la relaci√≥n entre nuestra target `precio` y algunas de las variables num√©ricas m√°s relevantes identificadas despu√©s de la exploraci√≥n del an√°lisis univariado.
Observaciones:
- `precio` vs. `m2_constr`: Hay una correlaci√≥n positiva, a medida que aumenta el tama√±o construido (metros cuadrados), el precio tiende a incrementarse. La dispersi√≥n muestra una nube de puntos con una tendencia ascendente.
- `precio` vs. `dormitorios`: Al igual que en las variables de metros construidos, el precio aparenta tener una tendencia ascendente.Aunque se ven algunos valores atipicos que tendremos que analizar.
- `precio` vs. `cod_barrio`: La relaci√≥n entre precio y c√≥digo de barrio es menos clara. Es probable que el gr√°fico refleje precios variados dentro de cada barrio, y que el barrio afecte, pero de manera categ√≥rica. Ser√° necesario analizar la comparaci√≥n de medias por barrio.
- `precio` vs. `banos`: La mayor√≠a de los datos est√°n agrupados en la parte inferior izquierda del gr√°fico. Muchas viviendas tienen precios bajos y cuentan con un n√∫mero reducido de ba√±os.Es posible que haya una ligera correlaci√≥n entre el n√∫mero de ba√±os y el precio de la vivienda. A medida que aumenta el n√∫mero de ba√±os ,aumente el precio de la vivienda.Hay un par de puntos alejados del grupo principal. Por ejemplo, un punto representa una vivienda con un precio muy alto pero con un n√∫mero reducido de ba√±os. Esto podr√≠a ser un error en los datos o una vivienda especial.
- `precio` vs.`viv_nuevas_transacciones`: Podemos ver una concentracion de transaciones d precios bajos en la esquina inferior izquierda.
-  `precio` vs. `renta neta media por hogar`. Muchos de los datos est√°n concentrados en la esquina inferior izquierda del gr√°fico. Esto sugiere que la mayor√≠a de las viviendas tienen precios bajos y est√°n asociadas con hogares de renta media m√°s baja. Aunque podemos ver algunos casos donde el precio de las viviendas o la renta media var√≠a significativamente (posibles valores at√≠picos).
#### *7.2.1.2 Matriz de correlaci√≥n y heatmap*
Utilizamos la matriz de correlaci√≥n para  identificar relaciones entre variables num√©ricas.
El mapa de calor nos sirve para conocer las variables y sus relaciones.
A primera vista vemos que alguna variable'inmuebles_ingresos √≥ cancha_tenis que son lineas completamente blancas , lo que parece indicar ausencia de datos.
Tambien se puede observar que hay algunas variables muy correladas entre ellas.
Vamos a estudiar de que varibles se trata.
Podemos observar que tenemos muchas variables con una correlaci√≥n significativa, es tan fuerte que podr√≠a indicar multicolinealidad, es decir, que b√°sicamente ofrecen la misma informaci√≥n.
Mostramos la correlaci√≥n de la variable 'target' con las dem√°s variables num√©ricas
Observaciones:
- Se puede apreciar una fuerte correlaci√≥n entre la variable *target* `precio` con: `m2_utiles`, `m2_constr`, y `banos`.
- Existe una correlaci√≥n m√°s baja pero igualmente importante con: `cod_distrito`,`dormitorios`, `renta neta media por persona`, `renta_bruta_media_por_hogar`, `mediana de la renta por unidad de consumo`, `renta bruta media por persona`, `renta bruta media por hogar`, `salud_bienestar_educacion`, `servicios_profesionales`, y `lineas_metro`.
- Hay una correlaci√≥n m√°s baja con: `Nuda propiedad`, `codigo_postal`, `hog_con_7`, `hog_con_8`, `hog_con_9`, y `hog_con_10`, `hog_con_11`.
#### *7.2.1.3 Histogramas y distribuci√≥n de variables num√©ricas* 
Seleccionamos un subconjunto de variables num√©ricas para hacer el estudio ya que identificamos que tienen alta correlaci√≥n con la variable target 'precio'.
Observaciones:
- En los histogramas, las variables m2_constr,dormitorios,ba√±os, presentan una distribuci√≥n sesgada a la derecha. Esto significa que la mayor√≠a de los valores est√°n concentrados en el rango bajo, mientras que hay algunas propiedades con valores extremadamente altos.
- En los boxplots, los valores extremos o *outliers* son muy evidentes, especialmente en variables como `m2_constr` .
- Existe una relaci√≥n clara entre los metros cuadrados y el precio, donde a mayor tama√±o del inmueble, mayor suele ser el precio. Sin embargo, la dispersi√≥n es alta, lo que indica que no siempre un inmueble m√°s grande es m√°s caro, probablemente debido a la ubicaci√≥n o caracter√≠sticas adicionales. Los boxplots muestran una gran cantidad de valores at√≠picos, lo que sugiere que existen propiedades que, a√∫n con tama√±os peque√±os, tienen precios extremadamente altos. Esto podr√≠a deberse a factores como la ubicaci√≥n premium o caracter√≠sticas de lujo.
- Se observa una tendencia donde los inmuebles con m√°s dormitorios y ba√±os tienen un precio m√°s alto. Sin embargo, el boxplot muestra que hay valores extremos, donde algunas viviendas con pocos dormitorios y ba√±os tienen precios elevados, lo que podr√≠a ser indicativo de la ubicaci√≥n de estas viviendas.
- Se evidencian diferencias significativas en los precios dependiendo del distrito o barrio. Los distritos m√°s exclusivos tienen un precio significativamente m√°s alto, mientras que en otras zonas el precio es m√°s accesible. El boxplot muestra una gran dispersi√≥n en algunos distritos, lo que sugiere una combinaci√≥n de propiedades de alto y bajo costo dentro del mismo distrito.
- Existe una correlaci√≥n positiva entre la renta media del hogar y el precio del inmueble: las zonas con mayores ingresos tienden a tener propiedades m√°s caras. El boxplot muestra una variabilidad considerable, lo que sugiere que aunque la renta media sea alta, hay excepciones con propiedades accesibles dentro de esas √°reas.
- En cuanto al numero de personas podemos observar que haymas personas en los distritos con las viviedas mas baratas.
- No parece haber una relaci√≥n lineal clara entre el n√∫mero de l√≠neas de metro cercanas y el precio del inmueble. En el boxplot, se observa una dispersi√≥n importante, lo que indica que la cercan√≠a a m√∫ltiples l√≠neas de metro no es un factor determinante del precio por s√≠ solo, pero podr√≠a influir dependiendo de la zona.
### *7.2.2 Variables categ√≥ricas*
Analizamos la relaci√≥n de la variable target `precio` con las variables categ√≥ricas.
Generamos barplots con la media y mediana de la variable a analizar (precio)  frente a varias categ√≥ricas.
Observaciones:
- Se observan diferencias significativas en el precio promedio en funci√≥n de distintas variables categ√≥ricas. 
- Se identifican algunas categor√≠as en variables como `tipo_inmueble`, `distrito`, `barrio`, `estado` y `tipologia` que presentan precios significativamente m√°s altos o bajos.
- En las variables `distrito`, se evidencian diferencias claras en el precio medio entre distintas zonas, lo que indica que la ubicaci√≥n es un factor determinante en el valor de los inmuebles.
- En algunos gr√°ficos, los intervalos de confianza son amplios, lo que indica que existe una gran dispersi√≥n en los precios dentro de ciertas categor√≠as. Algunas variables como `energ√≠a_calefaccion`, `letra_ce` o `tipo_suelo` parecen tener un impacto menos significativo en el precio, ya que las diferencias entre categor√≠as son menores.

Conclusi√≥n:
- Identificar las variables categ√≥ricas m√°s influyentes: Variables como `tipo_inmueble`, `distrito`, `barrio`, `estado` y `tipologia` deben ser consideradas en cualquier an√°lisis predictivo, ya que tienen un alto impacto en el precio.
- Reducir la cantidad de categor√≠as poco representadas: Algunas categor√≠as tienen muy pocos registros y podr√≠an agruparse en una categor√≠a m√°s general para mejorar la interpretaci√≥n de los datos.
- Analizar la interacci√≥n entre variables: Analizaremos si ciertas combinaciones de categor√≠as influyen a√∫n m√°s en el precio, por ejemplo, la tipologia de un inmueble dentro de un distrito espec√≠fico.
- Considerar la eliminaci√≥n o transformaci√≥n de variables menos relevantes: Si algunas variables categ√≥ricas no tienen una variaci√≥n significativa en los precios, podr√≠an descartarse en an√°lisis posteriores.
#### *7.2.3 Combinaci√≥n de variables categoricas vs precio*

##### Distrito y m2_contr vs precio
Se observa que las viviendas tienden a ser m√°s amplias dependiendo del distrito, y tambi√©n presentan precios m√°s elevados. Sin embargo, el distrito con el precio medio m√°s alto es Salamanca, pero este no coincide con las viviendas de mayor tama√±o en t√©rminos de metros cuadrados construidos. Esto indica que en Salamanca, el alto precio podr√≠a estar m√°s relacionado con factores como la ubicaci√≥n, o demanda, m√°s que con el tama√±o de las viviendas.
##### Dormitorios+ba√±os con respecto distrito y el precio
Para analizar la relaci√≥n entre el n√∫mero de dormitorios y ba√±os, su ubicaci√≥n y el precio, vamos a generar una gr√°fica de calor que muestra el precio promedio de las viviendas (en miles de euros) en funci√≥n de la suma de dormitorios y ba√±os (eje X) y la ubicaci√≥n (eje Y, que representa los diferentes distritos). 
El color azul representa precios m√°s bajos y el rojo precios m√°s altos.

A medida que aumenta la cantidad de dormitorios y ba√±os, los precios tienden a ser m√°s elevados.Sin embargo, este  patr√≥n no es uniforme en todos los distritos, lo que indica que otros factores como la ubicaci√≥n espec√≠fica tienen un impacto significativo.
Algunos distritos presentan precios elevados incluso para viviendas m√°s peque√±as, lo que sugiere que la ubicaci√≥n puede ser el principal determinante del precio en esos casos (por ejemplo, distritos exclusivos como Salamanca).

En otros distritos, los precios parecen estar m√°s relacionados con el tama√±o de la vivienda.
Los distritos m√°s asequibles tienen predominio de colores azulados incluso para viviendas m√°s grandes.
An√°lisis de valores at√≠picos:

Puede haber distritos donde viviendas m√°s grandes no correspondan proporcionalmente a precios m√°s altos, lo cual podr√≠a indicar factores externos como demanda, nivel socioecon√≥mico o antig√ºedad de las propiedades
# *8. Generaci√≥n de un fichero para el desarrollo de un modelo inicial baseline*


Vamos a generar un primer modelo baseline con los datos en bruto.
# *9. Limpieza y procesamiento de datos*
Dependiendo de la cantidad de valores nulos y duplicados detectados, se pueden tomar las siguientes acciones:
- Eliminar registros duplicados si no aportan valor al an√°lisis.
- Gestionar valores faltantes:
    Aquellos valores nulos que se imputar√°n a un valor fijo ("Desconcido" en categoricas, 0 en n√∫mericas) se realizaran en este capitulo.
    La imputaci√≥n de nulos que conlleve la utilizaci√≥n de estadisticos, ya sea la moda,la mediana o la media del conjunto de datos, se realizar√° la imputaci√≥n despu√©s de dividir entre train,validacion y test. Esto garantizar√° que la informaci√≥n de los tres conjuntos de datos permanezca independiente.
    Si lo realizaramos antes el modelo de entrenamiento podr√≠a beneficiarse de informaci√≥n del conjunto de validaci√≥n o test, generando resultados optimistas y poco realistas.Adem√°s garantiza que las m√©tricas obtenidas en validaci√≥n y test sean fiables y representen el rendimiento del modelo en datos desconocidos.

## *9.1 Variables categ√≥ricas: agrupaci√≥n e imputaci√≥n de nulos*

 
- *Algunas variables categ√≥ricas previamente definidas se convertir√°n en num√©ricas tras su agrupaci√≥n, con el objetivo de utilizarlas en el modelo.** Ejemplos de estas variables incluyen `estado` y `letra_ce`.  
- *Las variables categ√≥ricas que se conserven como tales al finalizar este cap√≠tulo tendr√°n sus valores nulos imputados con "Desconocido".*


Veamos el porcentaje de nulos de cada varaible
Revisamos los valores que toma cada variable
### *9.1.1 Distrito y Barrio*
La columnas distrito y barrio no tiene valores nulos
Observaciones:
- No se necesita hacer agrupaci√≥n.
- No se necesita imputar nulos.
### *9.1.2 Estado*
Creamos un diccionario de mapeo para agrupar las categor√≠as y posteriormente convertirlas a num√©ricas:
NaN: 0, Para reformar: 1, Buen estado: 2, Perfecto estado: 3, Reformado: 4, Obra nueva: 5
Hemos creado un diccionario llamado estado_map para asignar un valor num√©rico a cada descripci√≥n del estado de una vivienda, agrupando t√©rminos similares bajo un mismo n√∫mero, convirtiendo datos categ√≥ricos en valores n√∫mericos, para que los modelos de an√°lisis pueden manejarlos f√°cilmente.
Los valores asignados siguen una escala jer√°rquica: desde 0 valores faltantes, 1 para viviendas en mal estado (por ejemplo, "a reformar"), hasta 5 para viviendas nuevas o en perfecto estado. Esta transformaci√≥n simplifica el an√°lisis y a√±ade consistencia a la informaci√≥n del dataset. 
### *9.2.3 Antig√ºedad*
Observaciones:
- Se imputar√°n los nulos con el valor 'Desconocido'.
### *9.2.4 Tipo de suelo* ####################################
Observaciones:
- Se imputar√°n los nulos con el valor 'Desconocido'.
### *9.2.5 Letra de consumo / Letra emisiones (certificado energ√©tico)*
Al igual que el estado se han transformado las  variables 'letra_ce' y 'letra_emisiones' a enteras para utilizarla en el modelo
### *9.2.6 Tipolog√≠a de propiedad*
Observaciones:
- No se necesita imputar nulos.
### *9.2.7 Calefacci√≥n*
Tenemos 3 variables asociadas a la calefaccion instalacion_calefaccion,energia_calefaccion y tipo_calefaccion. Adem√°s tenemos una columna asociada a la generaci√≥n del agua caliente de la vivienda. Analizaremos los valores que tiene cada una de ellas.

Observaciones:
- Existe poca variabilidad en los datos teniendo una mayor√≠a de valores de 'Radiadores', eliminaremos esta columna.

             
Agrupadas las variables Observaciones: 'agua_caliente', 'energia_calefaccion', y 'tipo_calefaccion' ya que se refieren al mismo servicio para el inmueble y de esta manera ayudamos a completar datos faltantes.
#Ademas eliminamos la variable instalacion_calefaccion por que tiene muy poca variabilidad
### *9.2.8 Tipo de inmueble*
Observaciones:
- No se necesita hacer agrupaci√≥n.
- Se imputar√°n los nulos con el valor 'Desconocido'.
### *9.2.9 Tipo de cocina*
### *9.2.10 Aire acondicionado*
Observaciones:
- No se necesita agrupar.
- No se necesita imputar nulos.
### *9.2.12 Piscina*
### *9.2.13 Planta*
Se van a agrupar los valores encontrados
Los valores nulos de la columna planta se imputaran despues de la division entre train,validacion y test
### *9.2.14 Jard√≠n*
Variable convertida a entero para utilizarla en el modelo
### *9.2.13 Imputaci√≥n de nulos de las variables categ√≥ricas*
## *9.3 Variables booleanas: agrupaci√≥n e imputaci√≥n de nulos*
#### *9.3.1 Ascensor*
Seguimos teniendo un 54,34 % de valores nulos en ascensor
Observaciones:
Le aplicaremos la moda por barrio para la imputaci√≥n de nulos
#### 9.3.2 Balc√≥n, Terraza, Trastero
En el caso de estas variables vamos a asumir que la ausencia de informaci√≥n sobre la terraza,balc√≥n y trasero significa que el inmueble no tiene una. 
#### *9.3.4 Carpinterias*


Para las variables relacionadas con carpinter√≠as, crearemos un diccionario que asigne un valor num√©rico seg√∫n su calidad y eficiencia energ√©tica. Este enfoque permite clasificar las carpinter√≠as de manera l√≥gica, teniendo en cuenta que su precio tiende a aumentar a medida que mejora su eficiencia. As√≠, este criterio facilita el an√°lisis y la integraci√≥n de esta informaci√≥n en el modelo de datos.Adem√°s a los valores nulos les imputamos 0.
#### *9.3.5 Interior/Exterior*
Redefiniremos la columna "exterior" y le asignaremos valores num√©ricos en funci√≥n del siguiente criterio:
Si la columna "exterior" tiene  valor 1, se transforma en 2;
Si la columna "interior" tiene valor 1, se le asigna 0;
Y  para el resto de las filas, se asigna un valor de 1., ya que suponemos que hay menos viviendas totalmente interiores.

### 9.3.6 Imputaci√≥n de nulos de las variables booleanas

La imputaci√≥n de nulos se realizar√° con la moda de cada barrio por lo que haremos la imputaci√≥n despues de dividir entre train,validacion y test para garantizar que la informaci√≥n de estos tres conjuntos de datos permanezca independiente
Si lo realizaramos antes el modelo de entrenamiento podr√≠a beneficiarse de informaci√≥n del conjunto de validaci√≥n o test, generando resultados optimistas y poco realistas.Adem√°s garantiza que las m√©tricas obtenidas en validaci√≥n y teest sean fiables y representen el rendimiento del modelo en datos desconocidos.
## *9.4 Variables num√©ricas: agrupaci√≥n e imputaci√≥n de nulos*
Al igual que las variables binarias , las variables n√∫mericas no binarias la imputaci√≥n de nulos se realizar√° despues de dividir entre train,validacion y test para garantizar que la informaci√≥n de estos tres conjuntos de datos permanezca independiente, ya que el criterio que se va a seguir para realizar esta imputaci√≥n ser√° la mediana del valor por barrio.

### *9.4.1 Metros cuadrados √∫tiles*
### *9.4.2 Amueblado*
### *9.4.3 Ba√±os*
La imputaci√≥n de nulos de la varaible banos se har√° despues de dividir entre train y test, ay que vamos a utilizar el estaditico mediana aplicado a los datos
### *9.4.4 Dormitorios*
Revisamos la vivienda de 20 dormitorios
La tipologia Estudios se caracteria por que no tiene dormitorios, sino que el sal√≥n la cocina y el dormitorio est√°n en la misma estancia
La imputaci√≥n de nulos de la varaible dormitorios se har√° despues de dividir entre train y test, ay que vamos a utilizar el estaditico mediana aplicado a los datos
### *9.4.5 Gastos de comunidad*
No existe un criterio sencillo para imputar los nulos de gastos de comunidad, vamos a prescindir de la columna por que podemos introducir sesgos en el model
### *9.4.6 Garaje*
### *9.4.7 Analisis de Outliers
Haciendo el estudio Bivariado entre las variable target y algunas varaibles n√∫mericas pudimos ver que hay algunos datos que habia que analizar con mas detalle.
En primer lugar podiamos ver viviendas con muchos dormitorios con un precio y metros construidos menos que lo que se podia esperar para una vivienda con tantos dormitorios
##### Dormitorios
dfEDA.query("dormitorios==20")[["url","precio","m2_constr"]]
Se revisan las webs de estos anuncios y se comprueba que salvo https://www.pisos.com/comprar/piso-arcos28037-42572846684_527461/ el resto no se corresponden con una vivienda, son edificios unos en ruina para reconstruir , otros venta de varios apartamentos en el mismo edificio, etc.


##### Ba√±os
### *9.4.8 Imputaci√≥n de nulos de las variables num√©ricas*
Al iguales que las variables binarias, la imputaci√≥n de los valores nulos de las variables n√∫mericas no binarias se va a realizar despues de dividir el dataset en entrenamiento,  validaci√≥n y el test.
Variabilidad de los datos
Aunque estas columnas piscina tiene muy poca variabilidad ,son caracteristicas de las viviendas que por si solas no aportarian en un modelo por su gran cantidad de valores nulos y su poca variabilidad pero que agrupadas on otrass variables  pueden influir en la predici√≥n del precio de las viviendas.Mantenemos las columna. 
# *10. Correlaci√≥n entre variables n√∫mericas*
Analizamos la correlaci√≥n entre las variables n√∫mericas una vez realizada la transformaci√≥n de los datos
En la matriz de correlaci√≥n, observamos la presencia de algunos puntos rojos. Esto indica que existen variables altamente correlacionadas entre s√≠, lo que significa que est√°n proporcionando informaci√≥n redundante al modelo. Por lo tanto, procederemos a generar una lista de columnas que se pueden eliminar, ya que otras variables ya representan la misma informaci√≥n de manera efectiva. Este proceso nos ayudar√° a optimizar el modelo y evitar problemas de multicolinealidad
Creamos un dataset que incluye √∫nicamente las variables num√©ricas. Luego, analizamos la correlaci√≥n entre ellas para identificar aquellas que est√°n altamente correlacionadas (con un coeficiente superior al 90%). Posteriormente, eliminamos una de las variables en cada par altamente correlacionado para reducir la multicolinealidad y optimizar el rendimiento del modelo. Este proceso no solo mejora la interpretabilidad, sino que tambi√©n ayuda a evitar redundancias en los datos
Para determinar qu√© variable eliminaremos entre las que est√°n correlacionadas, analizaremos la correlaci√≥n de cada una de ellas con la variable objetivo, ademas tendremos en cuenta el % de nulos que tenia la variable en dataset original. Este enfoque nos permitir√° identificar cu√°l aporta menos informaci√≥n relevante al modelo y, de esa manera, optimizar el conjunto de variables.
### An√°lisis de las variables a eliminar

#### Comparaciones entre variables:
- **m2_utiles y m2_constr:**  
  Eliminamos `m2_utiles`, ya que `m2_constr` no ten√≠a valores nulos en el dataset original.

- **cod_barrio y cod_distrito:**  
  De momento mantenemos las dos, lnecesitaremos ambas varaibles en para realizar la imputaci√≥n de nulos.
  
- **num_persona,num_personas_mujeres y num_personas_hombres:**  
  Nos quedamos con `num_personas`, ya que est√° m√°s correlacionada con la variable target.

- **viv_usadas_transacciones y total_transacciones:**  
  Nos quedamos con `total_transacciones`, ya que est√° m√°s correlacionada con la variable target.

---

#### Bloque de variables relacionadas con la renta:
- **Variables analizadas:**  
  `renta_neta_media_por_persona`, `renta_neta_media_por_hogar`, `mediana_de_la_renta_por_unidad_de_consumo`, `renta_bruta_media_por_persona`, `renta_bruta_media_por_hogar`

- **Decisi√≥n:**  
  Nos quedamos con `renta_bruta_media_por_persona`, ya que es la variable m√°s correlacionada con el precio.

---

#### Bloque de variables relacionadas con los hogares:
- **Variables analizadas:**  
  `habitantes`, `hogares`, `hog_con_1`, `hog_con_2`, `hog_con_3`, `hog_con_4`, `hog_con_5`, `hog_con_6`,  
  `hog_con_7`, `hog_con_8`, `hog_con_9`, `hog_con_10`, `hog_con_11`, `hog_con_12`, `hog_con_13`, `hog_con_14`, `hog_con_15_y_m√°s`

- **Decisi√≥n:**  
  Nos quedamos con las columnas `habitantes`, `hog_con_10` y `hog_con_15_y_m√°s`.

#### Bloque de variables relacionadas con servicios deen el barrio:
- **Variables analizadas:** 
 `servicios_profesionales `, `comercio_serviciosminoristas `, `cultura_entretenimiento `,  `salud_bienestar_educacion `

 - **Decisi√≥n:**  
  Nos quedamos con las todas las columnas, se crear√° una columna como suma de las cuatro.

Generamos una copia del dataframe antes de realizar la division en train y test
# *10. Division entre train y test*
## *_10.1. Agrupaci√≥n viviendas por precio promedio barrio_*
Para realizar entre train y test, vamos a realizar una agrupaci√≥n de las viviendas por precio promedio por barrio de forma que los grupos train,test y validaci√≥n tengan viviendas de todos los grupos y el modelo sea entrenado con viviendas de todos los rangos de precio y barrios.
Cada barrio est√° en un grupo cod_barrio_group
En el grafico se aprecia que las viviendas del distrito de Salmanca estan entre el grupo 4 y 5, y el grupo 1 est√° formado por viviendas de los barrios de Puente de Vallecas, Carabanchel Villaverde y Villa de Vallecas fundamentalmente.
10.2 Division entre train ,validacion y test
Comprobamos que entrenameros con viviendas de los 131 barriode de Madrid
# *11. Feature Engineering*
## *11.1 Variables pendientes de imputar nulos*

#### * 11.1.1 Imputacion de nulos con la moda por barrio en variables booleanas *
#Igualamos dftrain_imputado  a dftrain
#### * 11.2.1 Imputacion de nulos con la mediana de grupos de m2_constr y barrio s *

Las variables numericas vamos a imputar nulos teniendo en cuenta dos agrupaciones,  barrio y cod_barrio_m2_contr

* Planta: Mediana por barrio y tipologia
* banos: Mediana por barrio y cod_barrio_m2_contr
* dormitorios : Mediana por barrio y cod_barrio_m2_contr
Llamamos a la funcion clasificar_barrios_por_m2 para crear en los conjuntos de train la agrupaci√≥n de m2_constr y barrio
Aplicamos la clasificaci√≥n realizada en dftrain a los conjuntos de datos de validaci√≥n y test
11.2.1.1 Ba√±os y dormitorios
Comprobaci√≥n en los nulos de ba√±o, del barrio de Embajadores, doc_barrio=12
11.2.1.2 Planta
Ahora imputo los nulos de planta del resto de tipologias diferentes a Atico
La mediana por barrio se quedar√° vacio si hay algun barrio que no tenga ningun valor de planta
11.2.1.3 Numero garajes
Voy a imputar el numero de garajes con la moda por barrio
## *11.2 Generaci√≥n de nuevas variables*
#### *11.2.1 Precio medio por barrio*
#### *11.2.2 Precio medio por tipologia y distrito*
Esto puede ayudar a entender si una propiedad est√° sobrevaluada o subvaluada en relaci√≥n con los ingresos de la zona. Un valor m√°s alto indicar√≠a que los precios son m√°s altos en relaci√≥n con el ingreso de las personas.

#### *1.2.2 Total estaciones*
#### *11.2.3 Habitaciones*
### 11.2.3 Proporci√≥n entre m2_constr y habitaciones
#### *11.2.4 Atributos lujo*
#### *11.2.5 Resto Atributos*
#### *11.2.6 Servicios Barrio*
#### *11.2.6 Frecuency encoding*


## *11.3 Categorical encoding*
Para realizar el categorial enooding nos quedamos con X_train, eliminando la variable target del dataframe
# *12. üö©An√°lisis estad√≠stico final: hallazgos clave y patrones relevantes*

Vamos a realizar las siguientes tareas

- Res√∫menes estad√≠sticos: Valores como la media, mediana, desviaci√≥n est√°ndar y percentiles.
- Graficas con las distribuciones de las variables relevantes.
- Relaciones entre variables: Correlaciones o dependencias entre las variables mediante gr√°ficos como diagramas de dispersi√≥n o mapas de calor.
- Valores at√≠picos y anomal√≠as: Identificaci√≥n de datos fuera de lo esperado o que puedan influir en el modelo.

Tabla con la definicion de las columnas tenemos en el dataset final

| **Variable**                         | **Descripci√≥n** |
|--------------------------------------|----------------|
| **cod_distrito**                      | C√≥digo del distrito donde se encuentra la vivienda |
| **cod_barrio**                        | C√≥digo del barrio donde se ubica la vivienda |
| **codigo_postal**                     | C√≥digo postal de la vivienda |
| **cod_barrio_frecuency**              | Frecuencia del c√≥digo de barrio en el dataset |
| **precio_mean_b**                     | Precio medio de las viviendas en el barrio |
| **renta_bruta_media_por_persona**     | Renta bruta media por persona en la zona | 
  **habitaciones**                      | Cantidad de habitaciones (dormitorios+ ba√±os) de la vivienda |
| **total_transacciones**               | N√∫mero total de transacciones de viviendas en la zona |
| **pm_tlogia_distrito**                | Precio medio por tipolog√≠a en el distrito |
| **hog_con_10**                        | N√∫mero de hogares con 10 personas |
| **viv_nuevas_transacciones**          | N√∫mero de transacciones de viviendas nuevas en la zona |
| **tamano_medio_del_hogar**            | Tama√±o medio del hogar en la zona |
| **lineas_metro**                      | N√∫mero de l√≠neas de metro cercanas |
| **m2_areasverdes**                    | Metros cuadrados de √°reas verdes cercanas |
| **total_estaciones**                  | N√∫mero total de estaciones de transporte p√∫blico cercanas |
| **estado**                            | Estado de conservaci√≥n de la vivienda |
| **energia**                           | Tipo de energia de califecci√≥n y agua caliente |
| **atrib**                             | Caracter√≠sticas adicionales de la vivienda |
| **planta**                            | Planta en la que se encuentra la vivienda |
| **ins_comunitaria**                   | Indica si tiene el agua caliente o la calefaccion es individual o comunitaria |
| **num_personas**                      | N√∫mero de personas que residen en el barrio |
| **tam_hogar**                         | Tama√±o del hogar |
| **atrib_lujo**                        | Suma de las caracteristicas de lujo de la vivienda |
| **serv_barrio**                       | Cantidad de servicios disponibles en el barrio |
| **m2_por_hab**                        | Metros cuadrados por habitacion en la vivienda |
| **m2_constr**                         | Metros cuadrados construidos de la vivienda |
| **hog_con_15_y_m√°s**                  | N√∫mero de hogares con 15 o m√°s personas |
| **amueblado**                         | Indica si la vivienda est√° amueblada |
| **eficiencia_carpinteria**            | Nivel de eficiencia de la carpinter√≠a en la vivienda |
| **url**                               | URL del anuncio de la vivienda |
| **certificado_energetico**            | Indica si tiene o no certificado de eficiencia energetica |
| **orientacion_este, oeste, sur, norte** | Variables binarias que indican la orientaci√≥n de la vivienda |
| **tipologia_Atico, Casa, Chalet, Duplex, Estudio, Piso** | Variables binarias que indican el tipo de vivienda |
| **antiguedad_10_30, 30_50, 5_10, Desconocido, m√°s_50, menos_5** | Variables binarias que indican la antig√ºedad de la vivienda |
| **tipo_inmueble_Desconocido, econ√≥mico, lujo, medio, se√±orial** | Variables binarias que indican el tipo de inmueble |
| **aire_Desconocido, Eficiente, Normal, Sin_Aire** | Variables binarias que indican la presencia y tipo de aire acondicionado |
| **tipo_suelo_Baldosa, Desconocido, Gres, Madera, Otros, Piedra, Radiante** | Variables binarias que indican el tipo de suelo |
| **grupo_cocina_Abierta, Amueblada, Desconocido, Equipada, Independiente, No_amueblada, Reformada, Sin_reforma** | Variables binarias que indican el tipo de cocina |


##### Union variable target a X_train

Para hacer el analisis estaditico final sobre el conjunto de datos X_train_final le uniremos la variable target ("precio")
#### Tipos de variables
##### Resumen estadistico

## *11.1 Distribuci√≥n variable target*
Las gr√°ficas muestran la distribuci√≥n de la variable "precio" en su forma original y despu√©s de aplicar una transformaci√≥n logar√≠tmica.

####   Distribuci√≥n Original del Precio (Histogramas y Boxplots)
- Histograma : La distribuci√≥n del precio es altamente sesgada a la derecha (sesgo positivo). La mayor√≠a de los valores est√°n concentrados en el rango bajo, mientras que hay algunos valores extremadamente altos (colas largas).
- Boxplot : Se observa una gran cantidad de valores at√≠picos (outliers) que se alejan del cuerpo principal de la distribuci√≥n, lo que sugiere que hay precios muy elevados en comparaci√≥n con la mayor√≠a.

####  Distribuci√≥n Logar√≠tmica del Precio
- Histograma : Despu√©s de aplicar una transformaci√≥n logar√≠tmica, la distribuci√≥n se vuelve m√°s sim√©trica y cercana a una distribuci√≥n normal. Se reducen los efectos de la asimetr√≠a y la dispersi√≥n.
- Boxplot : Se observa que los valores est√°n m√°s equilibrados y los outliers est√°n menos pronunciados, lo que indica que la transformaci√≥n logar√≠tmica ayuda a reducir la influencia de los valores extremos.

Por lo tanto, la transformaci√≥n logaritmica suaviza considerablemente la distribuci√≥n de la variable precio.
## *11.2 Distribuci√≥n variables n√∫mericas continuas*
Vamos a analizar la distribuci√≥n de las variables continuas con histogramas y graficos de viol√≠n
Vamos a analizar algunas graficas de varaibles creadas en el proceso de featuring engineers

* cod_barrio_frecuency: Presenta varios barrios con frecuencias distintas. Algunos barrios tienen muchas propiedades mientras que otros tienen pocas.En el grafico de violin la presencia de  m√∫ltiples picos refuerza la idea de que hay diferencias significativas en la cantidad de propiedades por barrio. Analizaremos su impacto en el precio.
* pm_tipologia_distrito : Parece tener valores discretos, lo que sugiere que est√° categorizando distintos tipos de inmuebles dentro de cada distrito.
 Es posible que haya distritos con una mayor variedad de tipolog√≠as que otros.
* atrib : En el histograma podemos observar que la mayor√≠a de los valores concentrados en un rango bajo.
El grafico de viol√≠n presenta una fuerte asimetr√≠a, lo que sugiere que la mayor√≠a de las propiedades tienen pocos atributos y unas pocas tienen muchos.
* atrib_lujo: La mayor√≠a de los valores parecen estar en 0, con unos pocos casos de valores altos,las viviendas de lujo son una minor√≠a en el dataset.Analizaremos esta variable con el precio.
* euro_m2_barrio: Tiene una distribuci√≥n m√°s normal que otras varaibles.En el grafico de violin se
observan variaciones en los valores por barrio, indicando que algunos barrios tienen un precio por metro cuadrado significativamente m√°s alto que otros. Tambi√©n pueden existir algunos valores extremos que representen barrios exclusivos o errores en los datos. Analizaremos esos valores.



Conclusi√≥n 
Algunas variables como cod_barrio_frecuency y pm_tipologia_distrito parecen representar categor√≠as con valores discretos y pueden estar dominadas por algunas clases m√°s frecuentes.
atrib_lujo y euro_m2_barrio podr√≠an estar directamente relacionados con precios altos y con zonas exclusivas, por lo que su an√°lisis es clave para la predicci√≥n de precios.

## *11.3 Distribuci√≥n variables n√∫mericas booleanas*
##### Distribucion varaibles categoricas
##### Relaciones entre variables
Variable atrib_lujo vs precio
Variable eurom2_barrio vs precio
Donde en la variable estado el 0 representa los valores desconocidos, 1 vivivendas que necesitan reforma, 2 viviendas en buen estado, 3 vviendas en  perfecto estado, 4 vivendas reformadas y 5 viviendas de obra nueva.
##### Matriz de correlaci√≥n
##### Valores Atipicos

### **1. Outliers en precio**  
- Hay algunas observaciones con precios extremadamente altos (en el orden de **10M+**).  
- Estos valores son propiedades de lujo ya que se ha comprobado que no son errores en los datos.  
- Ser√° conveniente realizar la transformaci√≥n logar√≠tmica para tratarlos.  

### **2.Otras variables con outliers claros**  
- **m2_constr**: Hay algunas viviendas con **m√°s de 2000-3000 m¬≤**, lo cual es at√≠pico para la mayor√≠a de los casos.  
- **num_personas**: Existen algunos valores extremadamente altos, llegando a m√°s de **60,000**, lo que indica que hay barrios con m√°s poblaci√≥n que otros.
- **serv_barrio**: Hay algunas observaciones con valores extremadamente altos, lo que indica que hay barrios con m√°s dotaci√≥n de servicios que otros.
- **renta_bruta_media_por_persona**: Se observan puntos alejados con valores superiores a **40,000**, que pueden ser valores de distritos con mejor nivel econmico.
- **m2_por_hab**: Hay valores inusualmente altos (**m√°s de 800 m¬≤ por habitaci√≥n**), lo que podr√≠a indicar errores en los datos.  

Se ven algunos cuadrados blancos que significan que hay variables correladas, revisemos las varibles con una correlaci√≥n fuerte entre ellas, y las variables mas correladas con la varaible target.
# *13. Generaci√≥n de ficheros .csv*

## *13.2 Exportaci√≥n train,test,validacion para generaci√≥n del modelo*
## *13.2 Exportaci√≥n Clustering*


Se va a generar un dataframe con todos los datos para realizar el analisis del clustering
#Cambiar tipo de dato "cod_barrio","cod_distrito","cod_postal" a entero



# *14. Conclusiones*
Ficheros json generados

"cod_barrio_mapping.json": Se dividen los barrios en 5 grupos equitativos seg√∫n el precio medio, asignando etiquetas del 1 al 5 a cada uno de los barrios. El fichero tambi√©n guarda los bins por los que se ha hecho la division de los barrios en grupos.
Se utiliza para que al hacer la division entre train y test todos los barrios y todos los precios est√©n representados en los 2 conjuntos

"estadisticos_imp_nulos_bool.json":  Almacena diccionarios, las modas por barrio y por distrito y barrio de train.

clasificacion_barrios_m2.json: Se dividen los barrios en 5 grupos segun la media de los m2 , asignando etiquetas del 1 al 5. El fichero tambien guarda los  bins de m2 por los que se ha hecho la division

#para imputar nulos en dormitorios, ba√±os y armarios
"median_codbarrio_m2_constr": valor de la mediana por barrio y distrito teniendo en cuenta el grupo de clasificacion de los m2

si con median_codbarrio_m2_constr" seguimos teniendo nulos por que no hay valor para un grupo  de m2 y un barrio o distrito se aplica
"median_global_m2_constr"

"max_planta": maxima planta por barrio y por distrito

"media_planta_porbarrioNoaticos"
"moda_num_garajes.json"

- La variable "precio" en su estado original presenta una distribuci√≥n altamente sesgada y con una gran cantidad de valores at√≠picos.
- La transformaci√≥n logar√≠tmica mejora la distribuci√≥n, haci√©ndola m√°s normal y facilitando su uso en modelos de regresi√≥n o an√°lisis estad√≠stico.
- Este tipo de transformaci√≥n puede ayudar a mejorar la interpretaci√≥n y el rendimiento de los modelos que asumen una distribuci√≥n normal en los datos.